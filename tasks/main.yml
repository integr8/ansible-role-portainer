---
- name: Create temporary directory to store related files
  tempfile:
    state: directory
    suffix: portainer
  register: portainer_temp_dir

- name: Copy docker-compose to manager
  copy:
    src: docker-compose.yml
    dest: "{{ portainer_temp_dir.path }}/docker-compose.yml"
  when: "inventory_hostname == groups['integr8-docker-swarm-manager'][0]"

- name: Deploy Portainer in Swarm
  command: 'docker stack deploy --compose-file {{ portainer_temp_dir.path }}/docker-compose.yml portainer'
  when: "inventory_hostname == groups['integr8-docker-swarm-manager'][0]"